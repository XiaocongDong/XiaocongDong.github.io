---
title: Code Review最佳实践
tags:
  - 软件工程
  - 最佳实践
  - Code Review
---
因为最近在工作上参与制定了团队的一些Code Review的规范，所以想在这里给大家分享一下和Code Review相关的一些经验。本篇文章会包括下面这些内容：
* 为什么需要Code Review
* 什么时候做Code Review
* Code Review的时候需要看什么内容

## 为什么需要Code Review
对于参与人数大于或者等于两个的项目来说，Code Review(CR)是一项比不可少的活动。在我看来Code Review有下面这些好处：
* **可以提高committer对于自己代码的标准**：按照我以前的经验，当一个人的代码会被review和不会被review的时候代码风格是完全不一样的。如果一个人写的代码不用别人看，永远都是直接推到`master`分支，或者可以随意合入`master`分支的话，这个人写代码的时候就不会有什么`顾忌`，自己想怎么写就怎么写，反正也不会有比人看。可是当他的代码需要被同伴review时，他的心态就完全不一样了，这个时候他会想办法精简代码，去掉一些硬编码的逻辑从而追求一些最佳实践，而且各种`TODO`和`FIXME`也会写得一清二楚。他如果不怎么做的话，作为一个及格的Code Reviewer，我们肯定不会将他的代码合入`master`分支。长期如此的话，committer自己的水平也会逐渐得到提高的。
* **知识共享**：俗话说的好：你有一个苹果，我有一个苹果，我们交换一下，一个人还是只有一个苹果；你有一个思想，我有一个思想，我们交换一下，一人就有了两个思想。这句话同样适用于我们进行软件开发。作为一个程序员，我们在面对同一个问题的时候，可能会有不同的解决方法。如果大家没有交流的话，那么每个人可能永远都只知道一种解决方法，大家也就没有进步可言。那么程序员之间如何互相学习呢？最简单的办法就是看别人的源代码，而Code Review的过程就是最好的阅读别人源代码的过程。因为当我们在帮committer进行review的时候，他提交的代码只专注于解决一个问题，这样代码量就不会很大，我们可以更加清晰地学习到他是如何解决某一个问题的。如果committer恰好用了一个巧妙的我们之前不知道的办法来解决问题的话，我们就可以学习到新的知识了。
* **保持代码的风格的一致性**：同一个项目里面不同的程序员由于背景不一样（可能来源于不同的项目，来源于不同的公司），他们解决问题的方法和思路就不一样。作为一个前端程序员我见过在同一个代码仓库里面同时使用了`redux-saga`和`redux-thunk`作为异步中间件的。如果作为code reviewer我们不对committer的代码进行约束的话，项目的代码风格就会组件多极分化，这无疑会增加项目的维护成本以及后面新加入开发者的学习成本。
* **提前发现代码的问题**：一些经验比较少的开发在写代码的时候可能考虑问题不够全面，如果一些边缘情况（edge case）没有考虑到，这时候如果code reviewer是一个工作经验比较多的同学的话，就可以帮committer提现发现问题，这样就可以避免在产品上线后再浪费时间去定位问题了。值得注意的是，就算code reviewer不是一个很资深的开发，他作为代码的局外人往往也可以考虑到当事人（committer）自己在写代码时考虑不到的情况的。

## 什么时候进行Code Review
Code Review一定要发生在各种CI自动化监测例如`单元测试`，`代码风格lint检查`等通过之后和代码正式合入`master`分支之前。

这里要注意的是：当我们在开发一个大的功能的时候，可以试着将这个功能分拆为几个小的功能模块就行Code Review。这是因为如果我们一直埋头开发，等到所有功能都开发完后再提MR的话，reviewer可能会被几百甚至几千行代码改动吓跑，到时候只会草草合并代码，这样就达不到code review的效果。可是如果开发者不想将自己未完成的功能模块合入`master`分支怎么办呢？这个时候可以使用一种叫做`stacked CR`的模式：首先从主分支切出一个`feature/big-feature`的分支，然后你后面在开发这个`big-feature`的时候，会从这个`feature/big-feature`分支切出各种小分支，例如`feature/big-feature-sub-feature1`，`feature/big-feature-sub-feature2`等。当你在小分支上开发完后就可以提CR将代码并到`feature/big-feature`上了。这样由于每个MR都很小，所以code reviewer就可以认真地看了。最后等你把所有的功能都合并到`feature/big-feature`上后，就可以提多一个CR将这个分支的内容归并到主分支上面了。这个时候虽然改动还是很多，不过由于code reviewer已经在之前的阶段看过了你所有的更改，这个时候他要看的东西其实就不多了，对他进行code review也不会有很大的阻碍。

## Code Review需要看什么东西
