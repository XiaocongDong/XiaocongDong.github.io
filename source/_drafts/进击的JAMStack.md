---
title: 进击的JAMStack
tags:
  - React
  - JavaScript
  - Markdown
  - GraphQL
---
最近在研究JAMStack的一些相关内容，发现这的确是个好东西，所以想写一篇文章把这个概念分享给还不了解JAMStack的同学。本篇文章主要包含以下的内容：
* 什么是JAMStack
* JAMStack有什么优势
* JAMStack适合什么应用
* JAMStack的一些例子
* 我的个人思考

## 什么是JAMStack
### 概念
**JAM**Stack中的JAM其实是三个词的缩写，它们分别是**J**avaScript, **A**PIs以及**M**arkdown。而Stack用中文的说法就是技术栈（Tech Stack），也就是我们在构建应用的时候具体使用到的技术的集合。举个例子，国外现在比较火的一个Stack叫做Mean Stack，它表示使用MongoDB + Express.js + AngularJS + Node.js这些技术来构建一个Web应用。因此用最通俗易懂的话来描述JAMStack就是：**使用JavaScript，APIs和Markdown三种技术来构建Web应用**。所以JAMStack是一种**问题解决方案**，而不是一个具体的实现。

接着我们再具体看一下JavaScript，APIs和Markdown这三种技术。

### JavaScript
在JAMStack的概念中，JavaScript指的是在客户端（client）实现动态网页效果的JavaScript，它既可以是React和Vue这种Web框架，也可以是原生的JavaScript。它主要被用来实现网页的动态效果。

### APIs
这里的API和我们平时开发调用的API是一样的。JAMStack的Web应用会通过JavaScript给后端API发送AJAX请求，后端API会以某种格式（一般是JSON）返回数据给前端。

### Markdown
[Mardown](https://baike.baidu.com/item/markdown/3245829?fr=aladdin)是一种轻量级的标记语言。在JAMStack的世界中，Markdown类型的文件通常是用来作为生成静态HTML文件的数据源。有用过[hexo](https://hexo.io/)写博客的同学对这个概念肯定不会陌生，因为hexo的原理就是将我们编写的Markdown文件根据我们指定的主题或者模板生成一些静态的HTML然后托管在github pages或者其它类似的**静态网站服务器**来供别人访问。

除了Markdown文件之外，JAMStack的静态数据源还可以是其它的东西，例如我们后面说到的[Gatsby](https://www.gatsbyjs.org/)（JAMStack的一种实现）就允许通过插件的方式使用SQL直接读取数据库的内容来生成静态页面。

了解了这三个概念的具体内容后，我们再通过一个[Gatsby](https://www.gatsbyjs.org)的小demo来体会一下JAMStack的应用是如何工作的。

### Gatsby Demo
由于文章篇幅的限制，我将不在这里为大家讲述Gatsby的具体用法，不过我后面会写一系列文章来教大家如何用Gatsby免费搭建你的Side Project（前端 + 后端），大家可以留意一下。

简单来说，[Gatsby](https://www.gatsbyjs.org/)是一个可以让开发者使用**React**，**GraphQL**等现代技术快速开发网站的静态网站生成器（static-site generator）。**它是存在于网站构建（build）阶段的一个工具**。为了给大家一个直观点的认识，我使用Gatsby搭建了一个简单的个人博客demo，demo的源代码可以在我的[github仓库](https://github.com/XiaocongDong/gatsby-demo)找到。

demo博客网站包含以下的功能：
* 博客列表页面：展示我发表的所有博客。（静态内容）
* 博客详情页面：展示每一篇博客的具体内容。（静态内容）
* 博客评论列表：游客评论博客以及展示用户对这篇博客的评论列表。（动态内容）

注意我在上面每个功能点的右边标出了这个功能是静态的还是动态的。所谓静态的内容就是那些不会经常发生变化的内容，这些内容在一段时间内不同用户访问的时候都会得到同样的结果。而动态的内容就是那些频繁发生变化的内容，例如游客对我的博客的评论。那么我为什么要区分开这两种类型的内容呢？要回答这个问题我们可以先看看如果使用服务端渲染（SSR）的方案这个博客应用是如何运行的。首先游客会向SSR服务器发送一个查看某个博客的请求，SSR服务器收到请求后向后端服务请求这个博客的内容然后渲染出一个HTML页面然后返回给用户。这时候如果其他用户也向SSR服务器请求了同样的资源，SSR服务器还是会做同样的工作，请求资源 + 渲染页面。这个时候其实SSR服务器消耗了很多IO和CPU资源来做这些重复性的渲染，而且随着你的博客访问量的增大这些无用的资源消耗也会越来越多，在不升级服务端资源的前提下用户体验也会随之变差。到这里你可能会问，既然服务端渲染这么浪费资源，直接将生成的js文件放静态服务器不行吗？从实现博客功能的层面上来说这是没有问题的，可是这对搜索引擎优化（SEO）很不友好，百度收录不了你的博客，你的网站火不起来啊！

为了避免重复性的无用渲染，Gatsby采取了**区分网站静态内容和动态内容**的技术方案。对于那些**不经常变动的而且希望被搜索引擎收录的**静态内容，Gatsby会在Webpack打包阶段就生成，这样就不需要在用户访问该页面的时候才浪费资源来渲染页面，而且这些静态文件还可以通过CDN来优化用户体验。而对于那些数据经常发生变化的且不需要被搜索引擎收录的内容，它们会等到浏览器实际渲染对应组件的时候才通过APIs动态获取数据渲染出来。

我们先来看一下demo的代码目录结构：

![](/source/images/jamstack/blog-structure.png)
上面代码中，server文件夹存放的是我为了展示动态获取评论列表实现的一个超简单的express应用，src部分对应着的是前端源代码，我们来看一下src文件夹底下的各个文件夹都是什么内容：
* blogs：这个文件夹是用来存放我用Markdown编写的博客文件，这些文件会在网站构建阶段被作为数据源来生成静态的HTML文件。
* components: 这个文件用来存放React组件。
* images：这个文件夹用来存放和博客相关的一些图片文件。
* pages: 这个文件夹存放着网站的路由，每一个文件对应着一个路由，而每一个路由都会有一个生成的HTML文件对应起来，这样用户在访问该路由的时候我们的静态网站服务器就可以直接返回对应的资源了，有使用过next来做SSR的同学对这个pages这个概念应该不会陌生了。
* templates: 这个文件夹用来存放一个页面模板，由于我们可能为每个博客在pages文件夹创建一个文件，所以需要使用模板文件在网站构建的时候获取所有的博客数据动态生成页面。

接着我们试着构建一下我们的应用，使用yarn build命令即可，打包完成后查看一下生成的文件：

![](/source/images/jamstack/build.png)

由上图可以看出，Gatsby打包完成后为每一个路由都生成了一个静态的HTML，而其他动态的部分被生成了一些列的js文件。生成的文件可以直接使用一些静态网站服务器例如nginx来为用户提供服务。我们来看一下demo跑起来的实际效果：

![](/source/images/jamstack/demo.gif)

从上图我们可以看到在博客列表主页中点击了”如何马上实现财富自由“这个标题进入到博客详情页面时，浏览器没有重新发起请求来获取博客详情页生成的HTML文件，这是因为浏览器在获取到Gatsby生成的第一个静态HTML后，我们的网站会演变成一个普通的React应用，所以和普通的SPA应用体验是一样的！换句话来说，**Gatsby让我们的Web应用既保留了服务端渲染SEO友好的优点，还保留了纯SPA应用流畅用户体验的优点**，这也是为什么我十分看好JAMStack的原因。除了这个之外，如果我们大概浏览器调试一下网络请求还会发现，在渲染博客详情页的时候，博客的评论列表是在组件渲染的时候才发起网络请求获取的，这就是我们这个应用动态的那部分了！

看完了Gatsby这个应用，我相信你对JAMStack大概也有了一定的认识了，接下来我们来看一下JAMStack的优势吧。

## JAMStack的优势
### 性能
由于JAMStack会将网站静态的内容在部署的时候提前生成静态的HTML文件，因此不存在服务端渲染的消耗，这也意味着会有很好的性能。

### 高性价比而且部署简单
JAMStack生成的静态网页可以部署在任何一个静态网站服务器中，其中还包括很多免费的平台例如github pages和netlify等。如果你的网站完全是静态的话其实这也就意味着你的网站不会花费你一分钱。其次，假使你的网站还是需要API的支持来实现网页的一些动态的功能，你也可以依靠Serverless或者Baas的好处，使用一些免费的后端服务，例如Auth0或者Firebase来实现网站的动态效果。如果你确实要实现自己的后端服务可是可以的，由于JAMStack将前端和后端API完全解耦了，这就意味着后端的需求更加明确，接口更加少，对网络带宽和计算资源的要求也就更低了，这也会给我们大大解决部署应用的成本。

### 更好的开发者体验
JAMStack可以让我们用React和Vue等流行框架进行Web开发，同时我们不用进行服务端渲染就可以做SEO优化。你要知道使用next和nuxt这种框架来进行服务端渲染其实并不是一件十分容易的事情，你首先的花费


将页面拆分为不同的类型，使应用更加容易、便宜地扩展。

更加安全，前后端职责分离，SSR也有类似的功能

## 什么时候该使用JAMStack
* SEO，What content do google search. 你需要被搜索引擎收录的内容是不是动态的？所谓动态得内容是具备以下特性的内容：
  * 内容需要被频繁更新
  * 内容是不是有很多
  * 是不是由第三方用户创建的内容

不适合用JAMStack的：
* 掘金这种论坛，内容被创建
* 微博这种社交软件

适合使用JAMStack的：
* 一些文档类的网站，例如React的官网
* 个人博客类网站
* Netflix，landing page need to be generated, why client side rendering can also be used for after user login.
* 一些有固定内容的静态内容以及一些不需要SEO的内容的混合应用可以使用JAMStack。